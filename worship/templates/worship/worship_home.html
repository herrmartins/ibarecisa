{% extends 'core/base.html' %}
{% block content %}
{% load static %}

<div class="container text-center" x-data="songSearch()">
    <p class="fs-1">Departamento de Música</p>

    <!-- Add Song Button -->
    <button type="button" class="btn btn-primary rounded-circle"
        style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; font-size: 24px;"
        data-bs-toggle="modal" data-bs-target="#addSongModal">
        +
    </button>

    <!-- Search Input -->
    <div class="d-flex justify-content-center">
        <div class="input-group input-group-lg">
            <input type="text" class="form-control" placeholder="Busca uma canção..." x-model="query"
                x-on:input.debounce.300ms="searchSongs">
        </div>
    </div>

    <!-- Responsive Results Display -->
    <div class="mt-4 row">
        <!-- Results by Title -->
        <div class="col-lg-6 mb-4">
            <div class="result-category" x-show="results.title_matches.length > 0">
                <p class="fs-3">Resultados por Título</p>
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th scope="col">Título</th>
                            <th scope="col">Artista</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="song in results.title_matches" :key="song.id">
                            <tr>
                                <td><a :href="getSongDetailUrl(song.id)" class="fw-bold" x-text="song.title"></a></td>
                                <td x-text="song.artist"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Results by Artist -->
        <div class="col-lg-6 mb-4">
            <div class="result-category" x-show="results.artist_matches.length > 0">
                <p class="fs-3">Resultados por Artista</p>
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th scope="col">Título</th>
                            <th scope="col">Artista</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="song in results.artist_matches" :key="song.id">
                            <tr>
                                <td><a :href="getSongDetailUrl(song.id)" class="fw-bold" x-text="song.title"></a></td>
                                <td x-text="song.artist"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Results by Lyrics -->
        <div class="col-lg-6 mb-4">
            <div class="result-category" x-show="results.lyrics_matches.length > 0">
                <p class="fs-3">Resultados por Letra</p>
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th scope="col">Título</th>
                            <th scope="col">Trecho</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="song in results.lyrics_matches" :key="song.id">
                            <tr>
                                <td><a :href="getSongDetailUrl(song.id)" class="fw-bold" x-text="song.title"></a></td>
                                <td x-html="song.snippet"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Results by Theme -->
        <div class="col-lg-6 mb-4">
            <div class="result-category" x-show="results.theme_matches.length > 0">
                <p class="fs-3">Resultados por Tema</p>
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th scope="col">Título</th>
                            <th scope="col">Tema</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="song in results.theme_matches" :key="song.id">
                            <tr>
                                <td><a :href="getSongDetailUrl(song.id)" class="fw-bold" x-text="song.title"></a></td>
                                <td x-text="song.theme.join(', ')"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addSongModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar nova canção</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form x-data="songForm()" x-init="initAddSongForm()">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="songTitle" class="form-label">Título</label>
                                    <input type="text" id="songTitle" class="form-control" x-model="title" required>
                                </div>
                                <div class="mb-3">
                                    <label for="artist" class="form-label">Adorador</label>
                                    <select id="artist" class="form-control" x-model="artist">
                                        <option value="">Selecione um adorador</option>
                                        <template x-for="artist in artists" :key="artist.id">
                                            <option :value="artist.id" x-text="artist.text"></option>
                                        </template>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="theme" class="form-label">Tema</label>
                                    <select id="theme" class="form-control" x-model="theme">
                                        <option value="">Selecione um tema</option>
                                        <template x-for="theme in themes" :key="theme.id">
                                            <option :value="theme.id" x-text="theme.text"></option>
                                        </template>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="hymnal" class="form-label">Hinário</label>
                                    <select id="hymnal" class="form-control" x-model="hymnal">
                                        <option value="">Selecione um hinário</option>
                                        <template x-for="hymnal in hymnals" :key="hymnal.id">
                                            <option :value="hymnal.id" x-text="hymnal.text"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="lyrics" class="form-label">Letra</label>
                                    <textarea id="lyrics" class="form-control" x-model="lyrics" rows="8"></textarea>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" @click="submitForm">Salvar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'js/song_search.js' %}"></script>
{% endblock %}