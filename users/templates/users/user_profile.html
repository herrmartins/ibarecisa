

{% extends 'core/base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/user_profile.css' %}">

<div class="user-profile-container">
    <div class="profile-header">
        <h1 class="profile-title">Perfil do Usuário</h1>
        <div class="d-flex justify-content-center mt-3">
            <a href="{% url 'users:user-profile-update' user_object.id %}" class="update-btn">
                <i class="bi bi-pencil-square me-2"></i>Atualizar Cadastro
            </a>
        </div>
    </div>

    <div class="card profile-image-card">
        <div class="card-body text-center">
            {% if user_object.profile_image %}
                <img src="{{ user_object.profile_image.url }}" alt="Profile Image" class="profile-image">
            {% else %}
                <img src="{% static 'img/user.png' %}" alt="Default Image" class="profile-image">
            {% endif %}
            <h4 class="mt-3">{{ user_object.first_name }} {{ user_object.last_name }}</h4>
        </div>
    </div>

    <div class="card statistics-card">
        <div class="card-body">
            <h5 class="statistics-title">
                <i class="bi bi-bar-chart me-2"></i>Estatísticas
            </h5>
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="stat-item">
                        <i class="bi bi-newspaper fs-1 mb-2 text-info"></i>
                        <h5>{{ user_object.post_set.count|add:user_object.comment_set.count }}</h5>
                        <p>Participação no Blog</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item">
                        <i class="bi bi-calendar-event-fill fs-1 mb-2 text-primary"></i>
                        <h5>{{ user_object.date_joined|timesince }}</h5>
                        <p>Membro há</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item">
                        <i class="bi bi-star-fill fs-1 mb-2 text-success"></i>
                        <h5>
                            {% if user_object.is_pastor %}Pastor{% elif user_object.is_secretary %}Secretário{% elif user_object.is_treasurer %}Tesoureiro{% else %}Membro{% endif %}
                        </h5>
                        <p>Função Principal</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card completeness-card">
        <div class="card-body">
            <h5 class="completeness-title">
                <i class="bi bi-graph-up me-2"></i>Completude do Perfil
            </h5>
            {% with total_fields=8 completed_fields=0 %}
                {% if user_object.profile_image %}{% firstof completed_fields completed_fields|add:1 %}{% endif %}
                {% if user_object.email %}{% firstof completed_fields completed_fields|add:1 %}{% endif %}
                {% if user_object.address %}{% firstof completed_fields completed_fields|add:1 %}{% endif %}
                {% if user_object.phone_number %}{% firstof completed_fields completed_fields|add:1 %}{% endif %}
                {% if user_object.date_of_birth %}{% firstof completed_fields completed_fields|add:1 %}{% endif %}
                {% if user_object.about %}{% firstof completed_fields completed_fields|add:1 %}{% endif %}
                {% if user_object.baptism_date %}{% firstof completed_fields completed_fields|add:1 %}{% endif %}
                {% if user_object.cpf %}{% firstof completed_fields completed_fields|add:1 %}{% endif %}
                {% widthratio completed_fields total_fields 100 as percentage %}
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar" role="progressbar" style="width: {{ percentage }}%" aria-valuenow="{{ percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">{{ completed_fields }}/{{ total_fields }} campos preenchidos ({{ percentage }}%)</small>
            {% endwith %}
        </div>
    </div>

    <div class="card info-card">
        <div class="card-body">
            <h5 class="info-title">
                <i class="bi bi-person-lines-fill me-2"></i>Informações Pessoais
            </h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="info-item">
                        <h6><i class="bi bi-envelope-fill me-2"></i>Email</h6>
                        <p>{{ user_object.email }}</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <h6><i class="bi bi-house-fill me-2"></i>Endereço</h6>
                        <p>{{ user_object.address|default:"Não informado" }}</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <h6><i class="bi bi-telephone-fill me-2"></i>Telefone</h6>
                        <p>
                            {{ user_object.phone_number|default:"Não informado" }}
                            {% if user_object.is_whatsapp %}
                                <i class="bi bi-whatsapp text-success ms-2" title="WhatsApp"></i>
                            {% endif %}
                        </p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <h6><i class="bi bi-calendar-event-fill me-2"></i>Data de Nascimento</h6>
                        <p>{{ user_object.date_of_birth|date:"d/m/Y"|default:"Não informado" }}</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <h6><i class="bi bi-calendar-check-fill me-2"></i>Data de Batismo</h6>
                        <p>{{ user_object.baptism_date|date:"d/m/Y"|default:"Não informado" }}</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <h6><i class="bi bi-person-vcard-fill me-2"></i>CPF</h6>
                        <p>{{ user_object.cpf|default:"Não informado" }}</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <h6><i class="bi bi-calendar-plus-fill me-2"></i>Membro desde</h6>
                        <p>{{ user_object.date_joined|date:"d/m/Y" }}</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <h6><i class="bi bi-clock-fill me-2"></i>Último acesso</h6>
                        <p>{{ user_object.last_login|date:"d/m/Y H:i"|default:"Nunca" }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if user_object.married_to or user_object.date_of_marriage %}
    <div class="card marriage-card">
        <div class="card-body">
            <h5 class="marriage-title">
                <i class="bi bi-heart-fill me-2"></i>Estado Civil
            </h5>
            <div class="row">
                {% if user_object.married_to %}
                <div class="col-md-6">
                    <p><strong>Cônjuge:</strong> {{ user_object.married_to.first_name }} {{ user_object.married_to.last_name }}</p>
                </div>
                {% endif %}
                {% if user_object.date_of_marriage %}
                <div class="col-md-6">
                    <p><strong>Data do Casamento:</strong> {{ user_object.date_of_marriage|date:"d/m/Y" }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    {% if user_object.about %}
    <div class="card about-card">
        <div class="card-body">
            <h5 class="about-title">
                <i class="bi bi-info-circle-fill me-2"></i>Sobre
            </h5>
            <p>{{ user_object.about }}</p>
        </div>
    </div>
    {% endif %}

    <div class="card roles-card">
        <div class="card-body">
            <h5 class="roles-title">
                <i class="bi bi-person-badge-fill me-2"></i>Funções e Tipo
            </h5>
            <div class="mb-3">
                <strong>Tipo de Usuário:</strong>
                <span class="badge ms-2
                    {% if user_object.type == 'REGULAR' %}bg-primary
                    {% elif user_object.type == 'STAFF' %}bg-success
                    {% elif user_object.type == 'CONGREGATED' %}bg-info
                    {% elif user_object.type == 'SIMPLE_USER' %}bg-secondary
                    {% else %}bg-dark{% endif %}">
                    <i class="bi bi-tag-fill me-1"></i>{{ user_object.get_type_display }}
                </span>
            </div>
            <div>
                <strong>Funções:</strong>
                <div class="d-flex flex-wrap gap-2 mt-2">
                    {% if user_object.is_pastor %}
                        <span class="badge bg-primary"><i class="bi bi-star-fill me-1"></i>Pastor</span>
                    {% endif %}
                    {% if user_object.is_secretary %}
                        <span class="badge bg-info"><i class="bi bi-file-earmark-text-fill me-1"></i>Secretário</span>
                    {% endif %}
                    {% if user_object.is_treasurer %}
                        <span class="badge bg-warning"><i class="bi bi-cash-coin me-1"></i>Tesoureiro</span>
                    {% endif %}
                    {% if not user_object.is_pastor and not user_object.is_secretary and not user_object.is_treasurer %}
                        <span class="badge bg-secondary">Membro</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="card actions-card">
        <div class="card-body text-center">
            <h5 class="actions-title">
                <i class="bi bi-gear me-2"></i>Ações
            </h5>
            <a href="{% url 'users:change-user-password' %}" class="btn btn-outline-secondary">
                <i class="bi bi-key-fill me-2"></i>Alterar Senha
            </a>
        </div>
    </div>
</div>
{% endblock %}
