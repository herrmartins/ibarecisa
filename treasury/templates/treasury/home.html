{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gradient-to-b from-slate-50 to-white">
  <!-- Header Section -->
  <div class="app-page-header">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="text-center mb-8">
        <h1 class="app-page-title">
          Tesouraria
        </h1>
        <p class="app-page-subtitle">
          Bem-vindo ao painel financeiro da igreja
        </p>
      </div>

      <!-- Stats Cards -->
      <div class="flex justify-center gap-4 sm:gap-6 flex-wrap">
        <div class="treasury-stat-card treasury-stat-balance">
          <div class="flex items-center justify-center gap-3 mb-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="text-sm font-medium text-white/90">Saldo Anterior</span>
          </div>
          <div class="text-3xl font-bold text-white" id="previousMonthBalance">{{ previous_month_account_balance }}</div>
        </div>

        <div class="treasury-stat-card treasury-stat-current">
          <div class="flex items-center justify-center gap-3 mb-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            <span class="text-sm font-medium text-white/90">Saldo Corrente</span>
          </div>
          <div class="text-3xl font-bold text-white" id="currentBalance"></div>
        </div>

        <div class="treasury-stat-card treasury-stat-monthly">
          <div class="flex items-center justify-center gap-3 mb-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
            <span class="text-sm font-medium text-white/90">Resultado Mensal</span>
          </div>
          <div class="text-3xl font-bold text-white" id="currentAnawareBalance"></div>
        </div>

        <div class="treasury-stat-card treasury-stat-income">
          <div class="flex items-center justify-center gap-3 mb-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
            </svg>
            <span class="text-sm font-medium text-white/90">Entradas</span>
          </div>
          <div class="text-3xl font-bold text-white" id="positive_transactions"></div>
        </div>

        <div class="treasury-stat-card treasury-stat-expense">
          <div class="flex items-center justify-center gap-3 mb-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6"/>
            </svg>
            <span class="text-sm font-medium text-white/90">Saídas</span>
          </div>
          <div class="text-3xl font-bold text-white" id="negative_transactions"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Month Navigation -->
    <div class="treasury-nav-month mb-8">
      <div class="flex items-center justify-center gap-3 flex-wrap">
        <button id="prevButton" class="treasury-nav-month-btn">
          Anterior
        </button>
        <select id="yearSelect" class="treasury-nav-month-select">
          {% for y in year_list %}
          <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
        <select id="monthSelect" class="treasury-nav-month-select">
          <option value="1">Janeiro</option>
          <option value="2">Fevereiro</option>
          <option value="3">Março</option>
          <option value="4">Abril</option>
          <option value="5">Maio</option>
          <option value="6">Junho</option>
          <option value="7">Julho</option>
          <option value="8">Agosto</option>
          <option value="9">Setembro</option>
          <option value="10">Outubro</option>
          <option value="11">Novembro</option>
          <option value="12">Dezembro</option>
        </select>
        <button id="nextButton" class="treasury-nav-month-btn">
          Próximo
        </button>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      {% if perms.treasury.add_transactionmodel %}
      <div class="lg:col-span-4 xl:col-span-1">
        <div class="treasury-form-card">
          <div class="treasury-form-header">
            <h5 class="treasury-form-title">Adicionar Transação</h5>
          </div>
          <div class="treasury-form-body">
            <div id="transactionError" class="treasury-alert treasury-alert-error" style="display: none;" role="alert">
              <strong>Erro:</strong> <span id="errorMessage"></span>
            </div>
            {% include 'treasury/transaction_form_chunck.html' with show_title=False %}
          </div>
        </div>
      </div>
      {% endif %}
      <div class="{% if perms.treasury.add_transactionmodel %}lg:col-span-4 xl:col-span-3{% else %}lg:col-span-4{% endif %}">
        <div class="treasury-table-card">
          <div class="treasury-form-header">
            <h5 class="treasury-form-title">Transações do Mês</h5>
          </div>
          <div class="overflow-x-auto" id="transactions_list">
            <table class="treasury-table" id="transactionsTable">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Descrição</th>
                  <th>Valor</th>
                  <th>Saldo</th>
                  <th>Editar</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
            <p id="noTransactionsMessage" class="text-center text-slate-500 py-8" style="display:none;">Não há transações para este mês...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Navigation -->
    <div class="mt-8">
      <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
        <svg class="w-6 h-6 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
        </svg>
        Acesso Rápido
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Transações -->
        <a href="{% url 'treasury:transactions' %}" class="treasury-nav-card">
          <div class="treasury-nav-icon treasury-nav-icon-transactions">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
            </svg>
          </div>
          <div class="treasury-nav-content">
            <h3 class="treasury-nav-title">Transações</h3>
            <p class="treasury-nav-desc">
              Visualize e gerencie todas as transações financeiras.
            </p>
          </div>
          <div class="treasury-nav-arrow">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </a>

        <!-- Relatórios -->
        <a href="{% url 'treasury:list-financial-reports' %}" class="treasury-nav-card">
          <div class="treasury-nav-icon treasury-nav-icon-reports">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          </div>
          <div class="treasury-nav-content">
            <h3 class="treasury-nav-title">Relatórios</h3>
            <p class="treasury-nav-desc">
              Gere relatórios mensais e analise o fluxo de caixa.
            </p>
          </div>
          <div class="treasury-nav-arrow">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </a>

        <!-- Categorias -->
        <a href="{% url 'treasury:list-categories' %}" class="treasury-nav-card">
          <div class="treasury-nav-icon treasury-nav-icon-categories">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
            </svg>
          </div>
          <div class="treasury-nav-content">
            <h3 class="treasury-nav-title">Categorias</h3>
            <p class="treasury-nav-desc">
              Gerencie categorias de receitas e despesas.
            </p>
          </div>
          <div class="treasury-nav-arrow">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </a>

        <!-- Gráficos -->
        <a href="{% url 'treasury:financial-charts' %}" class="treasury-nav-card">
          <div class="treasury-nav-icon treasury-nav-icon-charts">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/>
            </svg>
          </div>
          <div class="treasury-nav-content">
            <h3 class="treasury-nav-title">Análise</h3>
            <p class="treasury-nav-desc">
              Visualize gráficos e análises financeiras detalhadas.
            </p>
          </div>
          <div class="treasury-nav-arrow">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<script type="module" src="{% static 'js/load_transactions.js' %}"></script>
<script type="module" src="{% static 'js/add_transaction.js' %}?v={{ request.META.HTTP_DATE|default:'20240914' }}"></script>
<script type="module" src="{% static 'js/get_transactions.js' %}"></script>
<script type="module" src="{% static 'js/navigation.js' %}"></script>
{% endblock %}
