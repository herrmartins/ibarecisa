{% load static %}
<!DOCTYPE html>
<html lang="pt-BR" x-data>
<style>
    [x-cloak] { display: none !important; }
</style>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Diácono IBARECISA</title>
        {% block pre_alpine_scripts %}
        {% endblock pre_alpine_scripts %}
        <script defer src="{% static 'js/alpinejs.min.js' %}"></script>
        <link rel="stylesheet" href="{% static 'css/tailwind/output.css' %}">
    </head>

    <body>
        {% include 'core/navbar.html' %}
        {% include 'core/messages.html' %}
        <div class="mt-16">{% block content %} {% endblock %}</div>
        <script type="module" src="{% static 'js/comment_like.js' %}"></script>

        <!-- Alpine Stores Globais -->
        <script>
        document.addEventListener('alpine:init', () => {
            // Store de Preferências (persiste no localStorage)
            Alpine.store('prefs', Alpine.persist({
                theme: 'system',
                fontSize: 'normal',
                sidebarCollapsed: false,
                notificationsEnabled: true,
            }));

            // Store do Usuário (injetado pelo Django, NÃO persiste)
            Alpine.store('user', {
                id: {{ user.id|default:'null' }} || null,
                username: '{{ user.username|default:"" }}',
                firstName: '{{ user.first_name|default:"" }}',
                lastName: '{{ user.last_name|default:"" }}',
                email: '{{ user.email|default:"" }}',
                isAuthenticated: {{ user.is_authenticated|lower }},
                isStaff: {{ user.is_staff|lower }},
                userType: '{{ user.type|default:"" }}',
                // Métodos úteis
                get fullName() {
                    return `${this.firstName} ${this.lastName}`.trim() || this.username;
                },
                get displayName() {
                    return this.firstName || this.username;
                }
            });

            // Store de UI (estado temporário da interface)
            Alpine.store('ui', {
                mobileMenuOpen: false,
                activeDropdown: null,
                closeAllDropdowns() {
                    this.activeDropdown = null;
                }
            });
        });
        </script>
    </body>

</html>
