{% extends 'core/base.html' %} {% block content %}
{% load static %}

<div class="container py-4">
  <div class="text-center my-3">
    <p class="display-6 fw-light">Registro de Reuniões</p>
    <p class="text-muted">Gere atas com suporte de IA, pesquise conteúdos e gerencie modelos e trechos.</p>
  </div>

  <div class="row g-3 justify-content-center mb-4">
    <div class="col-6 col-md-3">
      <div class="p-2 stat-card bg-success text-white rounded text-center fw-bold">
        <div class="mb-1">Atas Registradas</div>
        <a class="d-inline-block mb-1" href="{% url 'secretarial:list-minutes' %}"><img width="24" height="24" src="{% static 'img/archive.svg' %}" alt=""></a>
        <div class="h6 fw-light">{{number_of_minutes}}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="p-2 stat-card bg-primary text-white rounded text-center fw-bold">
        <div class="mb-1">Modelos de Atas</div>
        <a class="d-inline-block mb-1" href="{% url 'secretarial:list-templates' %}"><img width="24" height="24" src="{% static 'img/file-text.svg' %}" alt=""></a>
        <div class="h6 fw-light">{{number_of_templates}}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="p-2 stat-card bg-info text-white rounded text-center fw-bold">
        <div class="mb-1">Trechos de Atas</div>
        <a class="d-inline-block mb-1" href="{% url 'secretarial:list-excerpts' %}"><img width="24" height="24" src="{% static 'img/file-minus.svg' %}" alt=""></a>
        <div class="h6 fw-light">{{number_of_excerpts}}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="p-2 stat-card bg-warning text-white rounded text-center fw-bold">
        <div class="mb-1">Projetos de Ata</div>
        <a class="d-inline-block mb-1" href="{% url 'secretarial:list-minutes-projects' %}"><img width="24" height="24" src="{% static 'img/edit.svg' %}" alt=""></a>
        <div class="h6 fw-light">{{number_of_projects}}</div>
      </div>
    </div>
  </div>

  <!-- Search and AI Form Section -->
  <div class="row justify-content-center mb-5">
    <div class="col-12 col-lg-8 col-xl-7">
      <div class="card shadow-sm border-0">
        <div class="card-body p-4">
          <!-- Search Form -->
          <form id="search-form" class="mb-4">
            <div class="row g-2 align-items-end">
              <div class="col-12 col-md-4">
                <label for="searched" class="form-label">Buscar por</label>
                <input type="text" id="searched" class="form-control" placeholder="Digite o critério de busca..." />
              </div>
              <div class="col-12 col-md-4">
                <label for="search-type" class="form-label">em</label>
                <select id="search-type" class="form-select">
                  <option value="minutes">em atas</option>
                  <option value="templates">em modelos de atas</option>
                  <option value="members">em membros</option>
                </select>
              </div>
              <div class="col-12 col-md-4 d-grid">
                <button type="submit" class="btn btn-dark">Buscar</button>
              </div>
            </div>
          </form>
          
          <div id="search-results" class="mb-3"></div>

          {% if user.is_secretary %}
          <hr class="my-4"/>
          
          <!-- AI Generation Form -->
          <form method="POST">
            {% csrf_token %}
            <div class="mb-3">
              <label class="form-label text-muted fw-medium">Modelo de Ata (opcional)</label>
              <select class="form-select" name="template" id="template">
                <option value="">Nenhum</option>
                {% for template in templates %}
                <option value="{{ template.pk }}">{{ template.title }}</option>
                {% endfor %}
              </select>
            </div>
            
            <div class="mb-4">
              <label class="form-label text-muted fw-medium">Prompt para IA</label>
              <textarea class="form-control" id="prompt" name="prompt"
                        placeholder="Descreva a reunião para gerar a ata com IA..."
                        rows="4" style="resize: vertical;"></textarea>
            </div>
            
            <div class="d-flex flex-wrap gap-2 justify-content-start">
              <button type="submit" class="btn btn-primary px-4">
                <i class="bi bi-stars me-1"></i> Gerar Ata com IA
              </button>
              <a href="{% url 'secretarial:new-minute-view' %}" class="btn btn-outline-secondary px-4">
                <i class="bi bi-file-earmark-plus me-1"></i> Nova Ata em Branco
              </a>
              <a href="{% url 'secretarial:list-templates' %}" class="btn btn-outline-dark px-4">
                <i class="bi bi-layers me-1"></i> Ver Modelos
              </a>
            </div>
          </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if user.is_secretary %}
  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title fw-light">Lista de atas</h5>
          <div class="list-group list-group-flush">
            {% if meeting_minutes %}
              {% for mm in meeting_minutes %}
                <a class="list-group-item list-group-item-action" href="{% url 'secretarial:minute-detail-view' mm.pk %}">{{ mm }}</a>
              {% endfor %}
            {% else %}
              <div class="text-muted small">Sem atas ainda.</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title fw-light">Ações rápidas</h5>
          <div class="d-flex flex-wrap gap-2">
            <a href="{% url 'secretarial:list-excerpts' %}" class="btn btn-outline-primary pill">Trechos</a>
            <a href="{% url 'secretarial:list-templates' %}" class="btn btn-outline-primary pill">Modelos</a>
            <a href="{% url 'secretarial:list-minutes-projects' %}" class="btn btn-outline-primary pill">Projetos</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <div class="container">
    <div class="row justify-content-center py-2">
      <div class="col-12 col-md-10 col-lg-8">
        <p class="fs-5 fw-light text-center">Lista de Atas</p>
        {% for m in minutes %}
          <p><a href="{% url 'secretarial:minute-detail-view' m.pk %}">{{ m }}</a></p>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script type="module" src="{% static 'js/secretarial_search.js' %}"></script>
{% endblock %}