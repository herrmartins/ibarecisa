{% extends 'core/base.html' %} {% block content %}
{% load static %}

<div class="container py-4">
  <div class="text-center my-3">
    <p class="display-6 fw-light">Registro de Reuniões</p>
    <p class="text-muted">Gere atas com suporte de IA, pesquise conteúdos e gerencie modelos e trechos.</p>
  </div>

  <div class="row g-3 justify-content-center mb-4">
    <div class="col-6 col-md-3">
      <div class="p-2 stat-card bg-success text-white rounded text-center fw-bold">
        <div class="mb-1">Atas Registradas</div>
        <a class="d-inline-block mb-1" href="{% url 'secretarial:list-minutes' %}"><img width="24" height="24" src="{% static 'img/archive.svg' %}" alt=""></a>
        <div class="h6 fw-light">{{number_of_minutes}}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="p-2 stat-card bg-primary text-white rounded text-center fw-bold">
        <div class="mb-1">Modelos de Atas</div>
        <a class="d-inline-block mb-1" href="{% url 'secretarial:list-templates' %}"><img width="24" height="24" src="{% static 'img/file-text.svg' %}" alt=""></a>
        <div class="h6 fw-light">{{number_of_templates}}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="p-2 stat-card bg-info text-white rounded text-center fw-bold">
        <div class="mb-1">Trechos de Atas</div>
        <a class="d-inline-block mb-1" href="{% url 'secretarial:list-excerpts' %}"><img width="24" height="24" src="{% static 'img/file-minus.svg' %}" alt=""></a>
        <div class="h6 fw-light">{{number_of_excerpts}}</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="p-2 stat-card bg-warning text-white rounded text-center fw-bold">
        <div class="mb-1">Projetos de Ata</div>
        <a class="d-inline-block mb-1" href="{% url 'secretarial:list-minutes-projects' %}"><img width="24" height="24" src="{% static 'img/edit.svg' %}" alt=""></a>
        <div class="h6 fw-light">{{number_of_projects}}</div>
      </div>
    </div>
  </div>

  <div class="ai-hero mb-4">
    <div class="ai-card">
      <form id="search-form" class="mb-3">
        <div class="row g-2 align-items-stretch">
          <div class="col-12 col-md-8">
            <div class="form-floating h-100">
              <input type="text" id="searched" class="form-control h-100" placeholder="Digite o critério de busca..." />
              <label for="searched" class="form-label">Escreva o(s) critério(s) da busca</label>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <select class="form-select h-100">
              <option>em atas</option>
              <option>em modelos de atas</option>
              <option>em pautas das atas</option>
            </select>
          </div>
          <div class="col-6 col-md-1 d-grid">
            <button type="submit" class="btn btn-dark pill">Buscar</button>
          </div>
        </div>
      </form>
      <div id="search-results" class="d-flex flex-column gap-2"></div>

      {% if user.is_secretary %}
      <hr class="my-3"/>
      <form method="POST">
        {% csrf_token %}
        <div class="mb-3">
          <label class="form-label text-muted">Modelo de Ata (opcional)</label>
          <select class="form-select" name="template" id="template">
            <option value="">Nenhum</option>
            {% for template in templates %}
            <option value="{{ template.pk }}">{{ template.title }}</option>
            {% endfor %}
          </select>
        </div>
        <label class="form-label text-muted">Prompt para IA</label>
        <textarea class="form-control ai-textarea" id="prompt" name="prompt" placeholder="Descreva a reunião para gerar a ata com IA..."></textarea>
        <div class="ai-actions">
          <button type="submit" class="btn btn-primary pill"><i class="bi bi-stars me-1"></i> Gerar Ata com IA</button>
          <a href="{% url 'secretarial:new-minute-view' %}" class="btn btn-outline-secondary pill"><i class="bi bi-file-earmark-plus me-1"></i> Nova Ata em Branco</a>
          <a href="{% url 'secretarial:list-templates' %}" class="btn btn-outline-dark pill"><i class="bi bi-layers me-1"></i> Ver Modelos</a>
        </div>
      </form>
      {% endif %}
    </div>
  </div>

  {% if user.is_secretary %}
  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title fw-light">Lista de atas</h5>
          <div class="list-group list-group-flush">
            {% if meeting_minutes %}
              {% for mm in meeting_minutes %}
                <a class="list-group-item list-group-item-action" href="{% url 'secretarial:minute-detail-view' mm.pk %}">{{ mm }}</a>
              {% endfor %}
            {% else %}
              <div class="text-muted small">Sem atas ainda.</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title fw-light">Ações rápidas</h5>
          <div class="d-flex flex-wrap gap-2">
            <a href="{% url 'secretarial:list-excerpts' %}" class="btn btn-outline-primary pill">Trechos</a>
            <a href="{% url 'secretarial:list-templates' %}" class="btn btn-outline-primary pill">Modelos</a>
            <a href="{% url 'secretarial:list-minutes-projects' %}" class="btn btn-outline-primary pill">Projetos</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <div class="container">
    <div class="row justify-content-center py-2">
      <div class="col-12 col-md-10 col-lg-8">
        <p class="fs-5 fw-light text-center">Lista de Atas</p>
        {% for m in minutes %}
          <p><a href="{% url 'secretarial:minute-detail-view' m.pk %}">{{ m }}</a></p>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script type="module" src="{% static 'js/secretarial_search.js' %}"></script>
{% endblock %}