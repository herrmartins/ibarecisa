{% extends 'core/base.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/styles.css'%}">

<div class="container">
  <div class="container text-center">
    <p class="fs-3 fw-light">Sessão de usuários</p>
  </div>

  <div class="container mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <h6 class="fw-light mb-0">Lista de Membros</h6>
      <a href="{% url 'secretarial:member-registration' %}" class="btn btn-primary">
        <i class="fas fa-user-plus"></i> Cadastrar Novo Membro
      </a>
    </div>
  </div>

  <div class="container">
    <table class="table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Funções</th>
          <th>Telefone</th>
          <th>E-mail</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for m in members %}
        <tr>
          <td><a href="{% url 'users:user-profile' m.pk %}">{{ m.first_name }} {{ m.last_name }}</a></td>
          <td>
            {% if m.is_pastor %}
            <p>Pastor</p>
            {% endif %}
            {% if m.is_secretary %}
            <p>Secretário</p>
            {% endif %}
            {% if m.is_treasurer %}
            <p>Tesoureiro</p>
            {% endif %}
            {% if not m.is_pastor and not m.is_secretary and not m.is_treasurer %}
              <p>{{m.type}}</p>
            {% endif %}
          </td>
          <td>
            {{m.phone_number}}
          </td>
          <td>
            {{m.email}}
          </td>
          <td>
            <div class="btn-group" role="group">
              <a href="{% url 'secretarial:user-qualify' m.id %}" class="btn btn-sm btn-outline-primary" title="Editar">
                <i class="fas fa-edit"></i>
              </a>
              {% if m.is_approved %}
              <span class="badge bg-success">Aprovado</span>
              {% else %}
              <span class="badge bg-warning">Pendente</span>
              {% endif %}
              {% if m.email and not m.has_usable_password %}
              <form method="post" action="{% url 'secretarial:send-password-email' m.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-success" title="Enviar senha por e-mail"
                        onclick="return confirm('Enviar e-mail de definição de senha para {{ m.first_name }}?')">
                  <i class="fas fa-envelope"></i> Enviar Senha
                </button>
              </form>
              {% elif m.has_usable_password %}
              <span class="badge bg-success">Usuário ativo</span>
              {% else %}
              <span class="badge bg-warning">Sem e-mail</span>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="container">
    <div class="row">
    <div class="col-8 mx-auto">
    <h6 class="fw-light"> Lista de usuários simples, contratos e congregados...</h6>
    <table class="table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td><a href="{% url 'users:user-profile' u.pk %}">{{ u.first_name }} {{ u.last_name }}</a></td>
          <td>
            <a href="{% url 'secretarial:user-qualify' u.id %}">
              <img src="{% static 'img/edit-black.svg' %}" class="">
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
  </div>
  </div>
</div>
{% endblock %}